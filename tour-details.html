<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tour Details - CaspianWaveTravel</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/tour-details.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
    <div id="page-loader" class="page-loader" style="display: none;">
        <div class="loader-spinner"></div>
        <p class="loader-text">Loading your Caspian Wave experience...</p>
    </div>

    <!-- Navigation -->
    <div id="nav-container"></div>

    <div class="tour-details-container">
        <!-- TOUR IMAGES - ELEGANT DESIGN WITH GALLERY MODAL -->
        <div class="tour-images-container">
            <div class="main-image">
                <img src="" alt="Main tour image" id="main-image">
                <div class="image-icon" data-action="open-gallery">
                    <i class="fas fa-images"></i>
                    <span class="image-count" id="image-count">View All</span>
                </div>
            </div>
            <div class="side-images">
                <div class="side-image" data-action="switch-image">
                    <img src="" alt="Tour image 2" id="side-image-1">
                    <div class="image-overlay">
                        <span class="view-more">View</span>
                        <span class="view-more-subtitle">Click to expand</span>
                    </div>
                </div>
                <div class="side-image" data-action="switch-image">
                    <img src="" alt="Tour image 3" id="side-image-2">
                    <div class="image-overlay">
                        <span class="view-more">View</span>
                        <span class="view-more-subtitle">Click to expand</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gallery Modal -->
        <div class="gallery-modal" id="gallery-modal">
            <div class="gallery-content">
                <div class="gallery-header">
                    <div class="gallery-info">
                        <h3>Tour Gallery</h3>
                        <span class="gallery-counter" id="gallery-counter">1 / 0</span>
                    </div>
                    <button class="close-gallery">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Full Screen View -->
                <div class="gallery-full-view" id="gallery-full-view">
                    <button class="lightbox-nav prev">
                        <i class="fas fa-chevron-left"></i>
                    </button>

                    <div class="lightbox-image-container">
                        <img id="lightbox-image" src="" alt="Gallery Image">
                        <div class="image-info">
                            <span id="image-number">1 / 0</span>
                            <button class="zoom-btn">
                                <i class="fas fa-search-plus"></i>
                            </button>
                        </div>
                    </div>

                    <button class="lightbox-nav next">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>

                <!-- Thumbnail Grid -->
                <div class="gallery-thumbnails" id="gallery-thumbnails">
                    <!-- Thumbnails will be loaded dynamically -->
                </div>
            </div>
        </div>

        <!-- Tour Content -->
        <div id="tour-content">
            <!-- Content will be dynamically loaded by tour-details.js -->
        </div>
    </div>

    <!-- Footer -->
    <div id="footer-container"></div>

    <!-- WhatsApp Button -->
    <a href="https://wa.me/994775700711" class="floating-whatsapp" target="_blank">
        <i class="fab fa-whatsapp"></i>
        <div class="animations"></div>
        <span class="pulse-ring"></span>
        <span class="pulse-ring pulse-ring-2"></span>
        <span class="notification-badge"></span>
        <span class="tooltip-arrow"></span>
    </a>

    <!-- JavaScript -->
    <script src="js/components-loader.js"></script>

    <!-- Load modular tour details files IN CORRECT ORDER -->
    <script src="js/tour-details/image-handler.js"></script>
    <script src="js/tour-details/tour-data.js"></script>
    <script src="js/tour-details/itinerary-handler.js"></script>
    <script src="js/tour-details/tour-renderer.js"></script>
    <script src="js/tour-details/tour-manager.js"></script>
    <script src="js/tour-details/init.js"></script>

    <!-- Simple fallback script -->
    <script>
        // Simple fallback to ensure gallery works
        window.addEventListener('load', function() {
            console.log('üì± Tour Details Page Fully Loaded');
            
            // Check if imageHandler was properly initialized
            setTimeout(() => {
                const imageHandler = window.imageHandler || window._imageHandlerInstance;
                
                if (imageHandler) {
                    console.log('‚úÖ ImageHandler found:', imageHandler.constructor.name);
                    
                    // If images are already loaded, ensure event listeners are set up
                    if (imageHandler.images && imageHandler.images.length > 0) {
                        console.log(`üì∏ ${imageHandler.images.length} images ready`);
                        
                        // Force re-setup of event listeners as a safety measure
                        if (typeof imageHandler.setupAllEventListeners === 'function') {
                            console.log('üîß Ensuring event listeners are set up');
                            imageHandler.setupAllEventListeners();
                        }
                    }
                } else {
                    console.warn('‚ö†Ô∏è ImageHandler not found - images may not work properly');
                }
            }, 1000); // Give modules time to load
        });
    </script>

    <script>
// BACKUP FIX FOR NAV LINKS ON TOUR-DETAILS PAGE
document.addEventListener('DOMContentLoaded', function() {
    if (!window.location.pathname.includes('tour-details.html')) return;
    
    console.log('üîß Applying backup fix for tour-details navigation...');
    
    // Fix links after a delay (in case nav loads later)
    setTimeout(function() {
        const navLinks = document.querySelectorAll('nav a[href^="#"]');
        
        navLinks.forEach(link => {
            const href = link.getAttribute('href');
            if (href && href.startsWith('#') && !href.includes('index.html')) {
                // Change #something to index.html#something
                link.setAttribute('href', 'index.html' + href);
                
                // Add aggressive click handler as backup
                link.addEventListener('click', function(e) {
                    if (window.location.pathname.includes('tour-details.html')) {
                        e.preventDefault();
                        window.location.href = 'index.html' + href;
                    }
                });
            }
        });
        
        console.log(`‚úÖ Fixed ${navLinks.length} navigation links`);
    }, 1000);
});
</script>
</body>
</html>