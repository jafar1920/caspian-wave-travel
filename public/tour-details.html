<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tour Details - CaspianWaveTravel</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/tour-details.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="js/modules/components/favicon-manager.js"></script>
</head>

<body>
    <div id="page-loader" class="page-loader" style="display: none;">
        <div class="loader-spinner"></div>
        <p class="loader-text">Loading your Caspian Wave experience...</p>
    </div>

    <!-- Navigation -->
    <div id="nav-container"></div>

    <div class="tour-details-container">
        <!-- TOUR IMAGES - ELEGANT DESIGN WITH GALLERY MODAL -->
        <div class="tour-images-container">
            <div class="main-image">
                <img src="" alt="Main tour image" id="main-image">
                <div class="image-icon" id="view-all-button">
                    <i class="fas fa-images"></i>
                    <span class="image-count" id="image-count">View All</span>
                </div>
            </div>
            <div class="side-images">
                <div class="side-image">
                    <img src="" alt="Tour image 2" id="side-image-1">
                    <div class="image-overlay">
                        <span class="view-more">View</span>
                        <span class="view-more-subtitle">Click to switch</span>
                    </div>
                </div>
                <div class="side-image">
                    <img src="" alt="Tour image 3" id="side-image-2">
                    <div class="image-overlay">
                        <span class="view-more">View</span>
                        <span class="view-more-subtitle">Click to switch</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gallery Modal -->
        <div class="gallery-modal" id="gallery-modal">
            <div class="gallery-content">
                <div class="gallery-header">
                    <div class="gallery-info">
                        <h3>Tour Gallery</h3>
                        <span class="gallery-counter" id="gallery-counter">1 / 0</span>
                    </div>
                    <button class="close-gallery">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Full Screen View -->
                <div class="gallery-full-view" id="gallery-full-view">
                    <button class="lightbox-nav prev">
                        <i class="fas fa-chevron-left"></i>
                    </button>

                    <div class="lightbox-image-container">
                        <img id="lightbox-image" src="" alt="Gallery Image">
                        <div class="image-info">
                            <span id="image-number">1 / 0</span>
                            <button class="zoom-btn">
                                <i class="fas fa-search-plus"></i>
                            </button>
                        </div>
                    </div>

                    <button class="lightbox-nav next">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>

                <!-- Thumbnail Grid -->
                <div class="gallery-thumbnails" id="gallery-thumbnails">
                    <!-- Thumbnails will be loaded dynamically -->
                </div>
            </div>
        </div>

        <!-- Tour Content -->
        <div id="tour-content">
            <!-- Content will be dynamically loaded by tour-details.js -->
        </div>
    </div>

    <!-- Footer -->
    <div id="footer-container"></div>

    <!-- WhatsApp Button -->
    <a href="https://wa.me/994775700711" class="floating-whatsapp" target="_blank">
        <i class="fab fa-whatsapp"></i>
        <div class="animations"></div>
        <span class="pulse-ring"></span>
        <span class="pulse-ring pulse-ring-2"></span>
        <span class="notification-badge"></span>
        <span class="tooltip-arrow"></span>
    </a>

    <!-- JavaScript - CORRECTED VERSION -->
   <script src="js/modules/components/loader-core.js"></script>
<script src="js/modules/components/page-initializer.js"></script>
<script src="js/modules/components/navbar-manager.js"></script>
<script src="js/modules/components/navigation-fixer.js"></script>
<script src="js/components-loader.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Firebase Service -->
    <script type="module" src="js/core/firebase/service.js"></script>
    <script src="js/modules/utils/formatters.js"></script>
<script src="js/modules/utils/dom-helpers.js"></script>
<script src="js/modules/utils/validators.js"></script>

<!-- DATA LOADER MODULE -->
<script src="js/modules/data/data-loader.js"></script>

<!-- COMPONENT LOADERS -->
<script src="js/modules/components/tours-loader.js"></script>
<script src="js/modules/components/packages-loader.js"></script>
<script src="js/modules/components/footer-loader.js"></script>

    <!-- Tour Modules IN CORRECT ORDER -->
     
<script src="js/modules/tours/data.js"></script>
<script src="js/modules/tours/image-handler/core.js"></script>
<script src="js/modules/tours/image-handler/dom-manager.js"></script>
<script src="js/modules/tours/image-handler/events.js"></script>
<script src="js/modules/tours/image-handler/gallery.js"></script>
<script src="js/modules/tours/image-handler/keyboard.js"></script>
<script src="js/modules/tours/renderer.js"></script>
<script src="js/modules/tours/manager.js"></script>
<script src="js/modules/tours/itinerary.js"></script>
<script src="js/pages/tour-details.js"></script>

    <!-- Debug Helper Script -->
    <script>
        // Debug helper for testing
        window.debugImageHandler = function() {
           
           
            
            
            // Check DOM elements
           
            
        };
        
        // Test clicks manually
        window.testClicks = function() {
            
            
            const mainImage = document.getElementById('main-image');
            const side1 = document.getElementById('side-image-1');
            const side2 = document.getElementById('side-image-2');
            const viewAll = document.getElementById('view-all-button');
            
            if (mainImage && mainImage.onclick) {
               
            } else {
                
            }
            
            // Simulate clicks
            if (mainImage) {
                mainImage.click();
               
            }
        };
    </script>

    <!-- Simple fallback script -->
    <script>
        window.addEventListener('load', function() {
            
            
            // Wait a bit for all scripts to initialize
            setTimeout(() => {
                
                
                // Check if manager was created
                if (window.TourDetailsManager) {
                    
                }
                
                // Check if image handler instance exists
                const managerInstance = window._tourManagerInstance;
                if (managerInstance && managerInstance.imageHandler) {
                    
                    
                    // Test if images are loaded
                    if (managerInstance.imageHandler.images && managerInstance.imageHandler.images.length > 0) {
                        
                        
                    
                    }
                } else {
                    
                    
                    // Try direct access
                    if (window.imageHandler) {
                        
                    } else if (window._imageHandlerInstance) {
                       
                    }
                }
                
                // Run debug helper
                if (window.debugImageHandler) {
                    window.debugImageHandler();
                }
            }, 1500);
        });
    </script>

    <script>
        // BACKUP FIX FOR NAV LINKS ON TOUR-DETAILS PAGE
        document.addEventListener('DOMContentLoaded', function() {
            if (!window.location.pathname.includes('tour-details.html')) return;
            
           
            
            // Fix links after a delay (in case nav loads later)
            setTimeout(function() {
                const navLinks = document.querySelectorAll('nav a[href^="#"]');
                
                navLinks.forEach(link => {
                    const href = link.getAttribute('href');
                    if (href && href.startsWith('#') && !href.includes('index.html')) {
                        // Change #something to index.html#something
                        link.setAttribute('href', 'index.html' + href);
                        
                        // Add aggressive click handler as backup
                        link.addEventListener('click', function(e) {
                            if (window.location.pathname.includes('tour-details.html')) {
                                e.preventDefault();
                                window.location.href = 'index.html' + href;
                            }
                        });
                    }
                });
                
               
            }, 1000);
        });
    </script>
</body>
</html>